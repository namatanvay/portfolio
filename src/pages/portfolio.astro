---
import Layout from "../layouts/Layout.astro";
import Navigation from "../components/Navigation.astro";
import Footer from "../components/Footer.astro";
import Gallery from "../components/Gallery";
import ClientShowcase from "../components/ClientShowcase";

// ============================================
// AUTOMATIC IMAGE DETECTION AT BUILD TIME
// ============================================
// All images are automatically discovered from folders
// Just add images to the folders and rebuild!

// Dynamically load event images
const eventImageModules = import.meta.glob('/public/images/events/**/*.{webp,jpg,jpeg,png}', { eager: true });

// Dynamically load portfolio images by category
const portraitImageModules = import.meta.glob('/public/images/portfolio/portraits/*.{webp,jpg,jpeg,png}', { eager: true });
const foodImageModules = import.meta.glob('/public/images/portfolio/food/*.{webp,jpg,jpeg,png}', { eager: true });
const productImageModules = import.meta.glob('/public/images/portfolio/product/*.{webp,jpg,jpeg,png}', { eager: true });

// Helper function to create portfolio items from image modules
function createPortfolioItems(modules: Record<string, any>, category: string, startId: number) {
  const items = [];
  let id = startId;

  for (const [path, module] of Object.entries(modules)) {
    const fileName = path.split('/').pop()?.replace(/\.(webp|jpg|jpeg|png)$/i, '') || '';
    const publicPath = path.replace('/public', '');

    items.push({
      id: id++,
      title: fileName.split(/[-_]/).map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '),
      category: category,
      image: publicPath,
      type: 'photo' as const,
    });
  }

  return items;
}

// Create portfolio items automatically
const portraitItems = createPortfolioItems(portraitImageModules, 'portraits-fashion', 1);
const foodItems = createPortfolioItems(foodImageModules, 'food', 1000);
const productItems = createPortfolioItems(productImageModules, 'product', 2000);

// Organize events with deduplication
const eventItemsMap = new Map(); // Use Map to deduplicate by image path
let eventId = 5000; // Start event IDs from 5000 to avoid conflicts

for (const [path, module] of Object.entries(eventImageModules)) {
  const match = path.match(/\/events\/([^\/]+)\/([^\/]+)$/);
  if (match) {
    const eventName = match[1];
    const fileName = match[2];
    const publicPath = path.replace('/public', '');

    // Only add if this image path doesn't already exist
    if (!eventItemsMap.has(publicPath)) {
      eventItemsMap.set(publicPath, {
        id: eventId++,
        title: eventName.split(/[-_]/).map(w => w.charAt(0).toUpperCase() + w.slice(1)).join(' '),
        category: 'events',
        eventName: eventName,
        image: publicPath,
        type: 'photo' as const,
      });
    }
  }
}

const eventItems = Array.from(eventItemsMap.values());

console.log(`ðŸ“ Auto-detected images:`);
console.log(`   - Portraits: ${portraitItems.length} photos`);
console.log(`   - Food: ${foodItems.length} photos`);
console.log(`   - Product: ${productItems.length} photos`);
console.log(`   - Events: ${eventItems.length} photos from ${new Set(eventItems.map(e => e.eventName)).size} events`);

// ============================================
// MANUALLY ADD VIDEOS HERE
// ============================================
// Photos are auto-detected, but videos need URLs
// Add your video URLs below (Cloudflare, Google Drive, etc.)
//
const manualVideos = [
  // Portraits & Fashion Videos
  {
    id: 10000,
    title: "Fashion Video - Valentino",
    category: "portraits-fashion",
    image: "/images/video-thumbnails/valentino-song.webp",
    video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187218/valentino-song-24k2_wt6g75.mp4",
    type: "video" as const,
  },

  // Events Videos
  {
    id: 10001,
    title: "Behind the Scenes",
    category: "events",
    image: "/images/video-thumbnails/bts-reel.webp",
    video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187323/bts-reel_utkia1.mp4",
    type: "video" as const,
  },
  {
    id: 10002,
    title: "BTS - Shooting Reel",
    category: "events",
    image: "/images/video-thumbnails/bts-shooting-reel.webp",
    video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187323/bts-shooting-reel_riwnpo.mp4",
    type: "video" as const,
  },
  {
    id: 10003,
    title: "Event Video Coverage",
    category: "events",
    image: "/images/video-thumbnails/bts-shoot-part1.webp",
    video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187330/bts-shoot-part1_szrngs.mp4",
    type: "video" as const,
  },

  // Food Videos
  {
    id: 10004,
    title: "Meraki Art Cafe",
    category: "food",
    image: "/images/video-thumbnails/meraki-art-cafe.webp",
    video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187273/meraki-art-cafe_sr3ede.mp4",
    type: "video" as const,
  },
  {
    id: 10005,
    title: "Meraki Cafe Announcement",
    category: "food",
    image: "/images/video-thumbnails/meraki-art-cafe-announcement.webp",
    video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187281/meraki-art-cafe-announcement_zsneoa.mp4",
    type: "video" as const,
  },
  {
    id: 10006,
    title: "Meraki Food",
    category: "food",
    image: "/images/video-thumbnails/meraki-food.webp",
    video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187259/meraki-food_fqcjqg.mp4",
    type: "video" as const,
  },
  {
    id: 10007,
    title: "Meraki Pizza",
    category: "food",
    image: "/images/video-thumbnails/meraki-food-pizza.webp",
    video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187275/meraki-food-pizza_fmz3q6.mp4",
    type: "video" as const,
  },
];

// Combine all portfolio items
const portfolioItems = [
  ...portraitItems,
  ...foodItems,
  ...productItems,
  ...eventItems,
  ...manualVideos,
];

// Client work showcase
const clients = [
  {
    name: "Meraki Art Cafe",
    description:
      "Food photography and videography for cafe menu and social media",
    work: [
      {
        id: 101,
        title: "Gourmet Dishes",
        category: "food",
        image: "/images/portfolio/food/TKN09226.webp",
        type: "photo" as const,
      },
      {
        id: 102,
        title: "Specialty Coffee",
        category: "food",
        image: "/images/portfolio/food/TKN09470.webp",
        type: "photo" as const,
      },
      {
        id: 103,
        title: "Cafe Promo Video",
        category: "food",
        image: "/images/video-thumbnails/meraki-art-cafe.webp",
        video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187273/meraki-art-cafe_sr3ede.mp4",
        type: "video" as const,
      },
    ],
  },
  {
    name: "Corporate Events",
    description:
      "Event coverage for corporate conferences and product launches",
    work: [
      {
        id: 201,
        title: "Conference Coverage",
        category: "events",
        image: "/images/events/MG/TKN05524.webp",
        type: "photo" as const,
      },
      {
        id: 202,
        title: "Event Networking",
        category: "events",
        image: "/images/events/MG/TKN06043.webp",
        type: "photo" as const,
      },
      {
        id: 203,
        title: "Behind the Scenes",
        category: "events",
        image: "/images/video-thumbnails/bts-reel.webp",
        video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187323/bts-reel_utkia1.mp4",
        type: "video" as const,
      },
    ],
  },
  {
    name: "Fashion Photography",
    description: "Portrait and fashion photography for seasonal campaigns",
    work: [
      {
        id: 301,
        title: "Fashion Editorial",
        category: "portraits-fashion",
        image: "/images/portfolio/portraits/TKN01607.webp",
        type: "photo" as const,
      },
      {
        id: 302,
        title: "Style Lookbook",
        category: "portraits-fashion",
        image: "/images/portfolio/portraits/TKN07847.webp",
        type: "photo" as const,
      },
      {
        id: 303,
        title: "Fashion Campaign",
        category: "portraits-fashion",
        image: "/images/video-thumbnails/valentino-song.webp",
        video: "https://res.cloudinary.com/de6djdkmi/video/upload/v1767187218/valentino-song-24k2_wt6g75.mp4",
        type: "video" as const,
      },
    ],
  },
  {
    name: "Commercial Product",
    description: "Product photography for e-commerce and advertising",
    work: [
      {
        id: 401,
        title: "Product Lifestyle",
        category: "product",
        image: "/images/portfolio/product/TKN02315.webp",
        type: "photo" as const,
      },
      {
        id: 402,
        title: "Commercial Shoot",
        category: "product",
        image: "/images/portfolio/product/TKN02347.webp",
        type: "photo" as const,
      },
      {
        id: 403,
        title: "Product Showcase",
        category: "product",
        image: "/images/portfolio/product/TKN04003.webp",
        type: "photo" as const,
      },
    ],
  },
];
---

<Layout
  title="Portfolio - Tanvay Nama"
  description="Browse through my photography and videography portfolio featuring portraits, events, landscapes, and commercial work"
>
  <!-- Preload critical images for LCP optimization -->
  <link
    slot="head"
    rel="preload"
    as="image"
    href="/images/portfolio/portraits/DSC01007.webp"
    fetchpriority="high"
  />
  <link
    slot="head"
    rel="preload"
    as="image"
    href="/images/portfolio/portraits/DSC02316.webp"
    fetchpriority="high"
  />

  <Navigation />

  <!-- Hero Section -->
  <section class="section pt-32 bg-dark-elevated text-center">
    <div class="container">
      <h1 class="text-5xl md:text-6xl font-bold mb-6">
        <span class="text-gradient">Portfolio</span>
      </h1>
      <p class="text-light text-xl mb-4">
        A collection of my best photography and videography work
      </p>
      <p class="text-muted max-w-3xl mx-auto">
        From intimate portraits to grand events, from breathtaking landscapes to
        compelling commercial work, explore the diverse range of projects that
        showcase my creative vision and technical expertise.
      </p>
    </div>
  </section>

  <!-- Gallery Section -->
  <section class="section">
    <div class="container">
      <Gallery items={portfolioItems} client:load />
    </div>
  </section>

  <!-- Client Showcase with Tabs -->
  <ClientShowcase clients={clients} client:load />

  <!-- CTA Section -->
  <section class="section bg-dark-elevated">
    <div class="container">
      <div class="text-center">
        <h2 class="text-4xl font-bold mb-4">Like What You See?</h2>
        <p class="text-muted text-lg mb-8 max-w-2xl mx-auto">
          Let's discuss how I can help bring your vision to life with
          professional photography and videography services.
        </p>
        <div class="flex flex-col sm:flex-row gap-4 justify-center">
          <a href="/services" class="btn btn-outline">
            <i class="fas fa-briefcase mr-2"></i>
            View Services
          </a>
          <a href="/contact" class="btn btn-primary">
            <i class="fas fa-envelope mr-2"></i>
            Get in Touch
          </a>
        </div>
      </div>
    </div>
  </section>

  <Footer />
</Layout>

<style>
  .text-gradient {
    background: linear-gradient(
      135deg,
      var(--accent-primary),
      var(--accent-secondary)
    );
    -webkit-background-clip: text;
    background-clip: text;
    -webkit-text-fill-color: transparent;
  }

  .text-light {
    color: var(--text-light);
  }

  .text-muted {
    color: var(--text-muted);
  }

  .bg-dark-elevated {
    background-color: var(--bg-dark-elevated);
  }

  .bg-dark-card {
    background-color: var(--bg-dark-card);
  }
</style>
